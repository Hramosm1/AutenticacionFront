<div class="flex flex-col flex-1">
  <app-title title="Permisos" subTitle="Mantenimiento"
    description="Desde aqui puedes otorgar permisos a roles en diferentes modulos"></app-title>
  <mat-form-field class="w-10/12 mx-auto">
    <mat-label>Modulo</mat-label>
    <mat-select [formControl]="modulo">
      <mat-optgroup *ngFor="let aplicaciones of modulos$|async" [label]="aplicaciones.aplicacion">
        <mat-option *ngFor="let modulo of aplicaciones.modulos" [value]="modulo">
          {{modulo.nombre}}
        </mat-option>
      </mat-optgroup>
    </mat-select>
  </mat-form-field>
  <div *ngIf="modulo.value" class="grid grid-cols-1 lg:grid-cols-4 gap-5 w-10/12 mx-auto mt-5">
    <mat-card class="lg:col-span-3">
      <ng-container *ngIf="formulario">
        <form [formGroup]="formulario">
          <button [disabled]="!formulario.touched" class="w-full" (click)="actualizar()" mat-raised-button
            color="accent">
            Actualizar
          </button>
          <div *ngIf="permisos$" class="grid grid-cols-1 lg:grid-cols-2 md:gap-5 w-10/12 mx-auto mt-8">
            <mat-card *ngFor="let permiso of permisos">
              <mat-card-header>
                <mat-card-title>{{permiso.rol | titlecase}}</mat-card-title>
                <mat-card-subtitle>{{permiso.aplicacion | uppercase}} - {{permiso.modulo}}</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content [formGroupName]="permiso.rol">
                <mat-list role="list">
                  <mat-list-item *ngFor="let accion of acciones" role="listitem">
                    {{accion|titlecase}} <span class="flex flex-1"></span>
                    <mat-checkbox [formControlName]="accion" color="primary"></mat-checkbox>
                  </mat-list-item>
                </mat-list>
              </mat-card-content>
            </mat-card>
          </div>
        </form>
      </ng-container>
    </mat-card>
    <mat-card class="lg:col-span-1">
      <app-permisos-especiales [aplicacion$]="aplicacion$.asObservable()"></app-permisos-especiales>
    </mat-card>
  </div>
</div>